# Model Components

This document details the format specifications for model components within the `model` section of the core animation file. These include activities, resources, generators, and connectors, defining the static structure and visual placeholders for the simulation.

> **Note:** For multi-replication support, the content described in this document is moved to the shared `model_layout.json` file. See [Multi-Replication Structure](./01b_multi_replication_structure.md) for details.

## Common Properties

All model components (activities, resources, generators) typically share these common properties, which are sourced from the `model.json` generated by the diagramming tool integration:

```json
{
  "id": "string",      // Unique identifier (from model.json)
  "name": "string",    // Human-readable name (from model.json)
  "type": "string",    // Component type (e.g., "Activity", "Resource", "Generator", "Connector")
  "x": "number",       // X-coordinate position on the diagram (from model.json)
  "y": "number",       // Y-coordinate position on the diagram (from model.json)
  "width": "number",   // Optional: Width of the component on the diagram (from model.json)
  "height": "number"   // Optional: Height of the component on the diagram (from model.json)
}
```

These coordinates and dimensions are crucial for placing animated elements correctly relative to the diagram background (e.g., an SVG).

## Activities

Activities represent processing stations, queues, or locations in the simulation model.

```json
{
  "id": "act1",
  "name": "Registration Desk",
  "type": "Activity",
  "x": 150,
  "y": 250,
  "width": 120,
  "height": 80,
  "capacity": 3, // From simulation model properties in model.json
  "inputBuffer": { // Visual representation details for an input queue area
    "x": 120,      // Relative or absolute X for the queue start point
    "y": 250,
    "capacity": 10,
    "direction": "left", // Direction entities queue up from, or orientation
    "spacing": 5     // Visual spacing between entities in queue
  },
  "outputBuffer": { // Visual representation for an output queue area
    "x": 180,
    "y": 250,
    "capacity": 5,
    "direction": "right",
    "spacing": 5
  },
  "resourceIds": ["res_clerk", "res_computer"], // IDs of resources used by this activity
  "visual_settings": { // Additional visual overrides not covered by defaultStyles
      "shape_type": "rectangle_rounded", // If not relying solely on SVG, e.g. "rectangle", "circle"
      "fillColor": "#AED6F1",
      "strokeColor": "#3498DB"
  }
}
```

### Activity Properties

| Property | Type | Required (for animation) | Description |
|----------|------|----------|-------------|
| `id` | string | Yes | Unique identifier |
| `name` | string | No | Human-readable name |
| `type` | string | Yes | Should be "Activity" |
| `x` | number | Yes | X-coordinate of the activity's primary anchor point |
| `y` | number | Yes | Y-coordinate of the activity's primary anchor point |
| `width` | number | No | Visual width for icon/area representation |
| `height` | number | No | Visual height for icon/area representation |
| `capacity` | number | No | Max number of entities (informational, from model) |
| `inputBuffer` | object | No | Defines visual properties for an input queue |
| `outputBuffer` | object | No | Defines visual properties for an output queue |
| `resourceIds` | array of strings | No | List of resource IDs this activity may use |
| `visual_settings` | object | No | Custom visual settings for this specific activity |

### Buffer Properties

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `x` | number | Yes | X-coordinate of the buffer |
| `y` | number | Yes | Y-coordinate of the buffer |
| `capacity` | number | No | Visual spots/capacity for entities in the buffer |
| `direction` | string | No | Direction entities queue up from ("left", "right", "up", "down") |
| `spacing` | number | No | Visual spacing between entities in queue |

## Resources

Resources represent agents, equipment, or other limited assets.

```json
{
  "id": "res_clerk",
  "name": "Registration Clerk",
  "type": "Resource",
  "x": 80,  // Location where idle resource icon might be shown
  "y": 150,
  "capacity": 2, // Total number of units for this resource type (from model.json)
  "visual_settings": {
      "icon_idle": "clerk_idle_sprite",
      "icon_busy": "clerk_busy_sprite"
  }
}
```

### Resource Properties

| Property | Type | Required (for animation) | Description |
|----------|------|----------|-------------|
| `id` | string | Yes | Unique identifier |
| `name` | string | No | Human-readable name |
| `type` | string | Yes | Should be "Resource" |
| `x` | number | No | X-coordinate for displaying resource status/icon |
| `y` | number | No | Y-coordinate for displaying resource status/icon |
| `capacity` | number | No | Total number of units (informational) |
| `visual_settings` | object | No | Custom visual settings |

## Generators

Generators are the source of entities entering the simulation model.

```json
{
  "id": "gen_patient_arrival",
  "name": "Patient Arrivals",
  "type": "Generator",
  "x": 50,
  "y": 250,
  "generatesEntityType": "Patient", // Type of entity created (links to visualization.entityTypes)
  "visual_settings": {
      "icon": "entrance_icon_sprite"
  }
}
```

### Generator Properties

| Property | Type | Required (for animation) | Description |
|----------|------|----------|-------------|
| `id` | string | Yes | Unique identifier |
| `name` | string | No | Human-readable name |
| `type` | string | Yes | Should be "Generator" |
| `x` | number | Yes | X-coordinate of the generation point |
| `y` | number | Yes | Y-coordinate of the generation point |
| `generatesEntityType` | string | No | The type of entity this generator produces |
| `visual_settings` | object | No | Custom visual settings |

## Connectors

Connectors define the paths or links between other components (Activities, Generators). Their visual representation is often part of the SVG background, but their logical definition from model.json (source/target IDs) is used to inform entity movement logic.

```json
{
  "id": "conn_reg_to_triage",
  "name": "Registration to Triage Path",
  "type": "Connector",
  "sourceId": "act_registration", // ID of the source Activity or Generator
  "targetId": "act_triage",   // ID of the target Activity
  // X, Y, Width, Height are typically not directly applicable here if relying on SVG for paths
  // However, start/end/control points might be stored if needed for complex path animation not in SVG
  "visual_settings": {
      "line_style": "dashed", // If drawn by animation engine not SVG
      "line_color": "#FF00FF"
  },
  "pathPoints": [ // Optional: if the animation engine needs to draw/animate along a non-trivial path not in SVG
      {"x": 100, "y": 200}, // Start (matches source component's exit point)
      {"x": 150, "y": 220}, // Control point or intermediate point
      {"x": 200, "y": 200}  // End (matches target component's entry point)
  ]
}
```

### Connector Properties

| Property | Type | Required (for animation) | Description |
|----------|------|----------|-------------|
| `id` | string | Yes | Unique identifier |
| `name` | string | No | Human-readable name |
| `type` | string | Yes | Should be "Connector" |
| `sourceId` | string | Yes | ID of the source component |
| `targetId` | string | Yes | ID of the target component |
| `visual_settings` | object | No | Custom visual settings if not purely SVG |
| `pathPoints` | array of objects | No | Explicit points for drawing animated paths if not in SVG. Each point is {"x": number, "y": number} |

## Relationships Between Components

Components reference each other using their IDs:

- Activities may reference resources through `resourceIds`
- Connectors use `sourceId` and `targetId` to link activities and generators
- Entities (defined in external path files, see [Entity Paths](./03_entity_paths.md)) will reference these component IDs in their movement paths

All IDs must be consistent and valid within the overall model definition (including data from model.json).

## Special Note on Coordinates

All coordinates (x, y) and dimensions (width, height) are specified in a 2D Cartesian coordinate system that should align with the coordinate system of the main diagram (e.g., the diagram.svg file, considering any transforms). Typically:

- X increases from left to right
- Y increases from top to bottom

These values are primarily sourced from the model.json file which reflects the layout in the diagramming tool.
